<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Phonogram Puzzle</title>
  <style>
    body {
      font-family: "Segoe UI", Arial, sans-serif;
      text-align: center;
      margin: 20px;
      background: linear-gradient(to right, #74ebd5, #ACB6E5);
      color: #333;
    }

    h1 { margin-bottom: 20px; }

    #image-container {
      position: relative;
      width: 400px;
      height: 200px; /* 2 rows of 100px */
      margin: 20px auto;
      border: 2px solid #333;
      overflow: hidden;
    }

    .image-piece {
      position: absolute;
      width: 25%;  /* 4 pieces per row */
      height: 50%; /* 2 rows */
      overflow: hidden;
      opacity: 0;
      transition: opacity 0.5s;
    }

    .image-piece img {
      position: absolute;
    }

    button, input[type="text"] {
      padding: 10px 15px;
      font-size: 1.2rem;
      margin: 5px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
    }

    button:hover { transform: scale(1.05); }

    #message { font-weight: bold; margin-top: 10px; min-height: 24px; }
    #end-buttons { display: none; margin-top: 15px; }
    #start-over { background-color: #2563eb; color: white; }
  </style>
</head>
<body>
  <h1>üéß Phonogram Puzzle üéß</h1>

  <div id="game">
    <audio id="audio" controls></audio>
    <div>
      <input type="text" id="answer" placeholder="Type your answer here" autofocus />
      <button onclick="checkAnswer()">Submit</button>
    </div>
    <div id="message"></div>
    <div id="end-buttons">
      <button id="start-over" onclick="startOver()">üîÑ Start Over</button>
      <button onclick="goHome()">üè† Return to Homepage</button>
    </div>
  </div>

  <div id="image-container">
    <div class="image-piece" style="top:0; left:0;"><img src=""></div>
    <div class="image-piece" style="top:0; left:25%;"><img src=""></div>
    <div class="image-piece" style="top:0; left:50%;"><img src=""></div>
    <div class="image-piece" style="top:0; left:75%;"><img src=""></div>
    <div class="image-piece" style="top:50%; left:0;"><img src=""></div>
    <div class="image-piece" style="top:50%; left:25%;"><img src=""></div>
    <div class="image-piece" style="top:50%; left:50%;"><img src=""></div>
    <div class="image-piece" style="top:50%; left:75%;"><img src=""></div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
  <script>
    const questions = [
      { src: "audioClips/a.m4a", answer: "a" },
      { src: "audioClips/c.m4a", answer: "c" },
      { src: "audioClips/d.m4a", answer: "d" },
      { src: "audioClips/ea.m4a", answer: "ea" },
      { src: "audioClips/er.m4a", answer: "er" },
      { src: "audioClips/g.m4a", answer: "g" },
      { src: "audioClips/i.m4a", answer: "i" },
      { src: "audioClips/ir.m4a", answer: "ir" },
      { src: "audioClips/o.m4a", answer: "o" },
      { src: "audioClips/oe.m4a", answer: "oe" },
      { src: "audioClips/oo.m4a", answer: "oo" }
    ];

    const images = [
      "images/daisy.jpg",
      "images/duck.jpg",
      "images/flying_bird.jpg",
      "images/lotus.jpg",
      "images/sun.jpg"
    ];

    let questionOrder = [];
    let currentIndex = 0;
    let revealedPieces = [];
    const audioEl = document.getElementById("audio");
    const answerEl = document.getElementById("answer");
    const messageEl = document.getElementById("message");
    const endButtons = document.getElementById("end-buttons");
    const pieceEls = document.querySelectorAll(".image-piece");

    const containerWidth = 400;
    const containerHeight = 200;
    const rows = 2;
    const cols = 4;

    function shuffleArray(arr) {
      return arr
        .map(v => ({ value: v, sort: Math.random() }))
        .sort((a,b) => a.sort - b.sort)
        .map(({value}) => value);
    }

    function initGame() {
      const currentImage = images[Math.floor(Math.random() * images.length)];
      questionOrder = shuffleArray([...questions]);
      currentIndex = 0;
      revealedPieces = [];

      pieceEls.forEach((piece, idx) => {
        piece.style.opacity = 0;
        const img = piece.querySelector("img");
        img.src = currentImage;

        // Each piece shows a slice of the full image
        img.style.width = `${containerWidth * cols}px`;
        img.style.height = `${containerHeight * rows}px`;

        const row = Math.floor(idx / cols);
        const col = idx % cols;
        img.style.left = `-${col * containerWidth}px`;
        img.style.top = `-${row * containerHeight}px`;
      });

      endButtons.style.display = "none";
      loadQuestion(currentIndex);
    }

    function loadQuestion(index) {
      if (index >= questionOrder.length) {
        messageEl.textContent = "üéâ You completed all questions! üéâ";
        audioEl.src = "";
        endButtons.style.display = "block";
        return;
      }
      audioEl.src = questionOrder[index].src;
      answerEl.value = "";
      messageEl.textContent = "";
      audioEl.play();
      answerEl.focus();
    }

    answerEl.addEventListener("keydown", e => {
      if (e.key === "Enter") checkAnswer();
    });

    function checkAnswer() {
      const userAnswer = answerEl.value.trim().toLowerCase();
      const correctAnswer = questionOrder[currentIndex].answer.toLowerCase();

      if (userAnswer === correctAnswer) {
        messageEl.textContent = "‚úÖ Correct!";
        messageEl.style.color = "#2E7D32";
        revealRandomPiece();

        currentIndex++;
        if (currentIndex < 8) setTimeout(() => loadQuestion(currentIndex), 800);
      } else {
        messageEl.textContent = "‚ùå Try Again!";
        messageEl.style.color = "#D32F2F";
      }
    }

    function revealRandomPiece() {
      const remaining = [...Array(8).keys()].filter(i => !revealedPieces.includes(i));
      if (!remaining.length) return;

      const randIdx = remaining[Math.floor(Math.random() * remaining.length)];
      revealedPieces.push(randIdx);
      pieceEls[randIdx].style.opacity = 1;

      if (revealedPieces.length === 8) {
        celebrateWin();
        messageEl.textContent = "üéâ You revealed the full image! üéâ";
        endButtons.style.display = "block";
      }
    }

    function startOver() { initGame(); }
    function goHome() { window.location.href = "index.html"; }
    function celebrateWin() {
      confetti({ particleCount: 200, spread: 70, origin: { y: 0.6 } });
    }

    initGame();
  </script>
</body>
</html>
